using System;
using System.Security.Cryptography;
using System.Security.Cryptography.X509Certificates;
using fiskaltrust.ifPOS.v2.es;
using fiskaltrust.Middleware.SCU.ES.TicketBAI.Common;
using fiskaltrust.Middleware.SCU.ES.TicketBAIBizkaia;
using Microsoft.Extensions.Logging.Abstractions;
using Xunit;

namespace fiskaltrust.Middleware.SCU.ES.AcceptanceTest;

[Collection("TicketBAI Bizkaia Tests")]
public class TicketBAIBizkaiaAcceptanceTests : ESScuAcceptanceTestBase
{
    private readonly TicketBaiSCUConfiguration _configuration;

    public TicketBAIBizkaiaAcceptanceTests()
    {
        var certificateBase64 = "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\r\n";
        var certificatePassword = "IZDesa2025";
        // Note: Certificate NIF extracted from ORGANIZATIONIDENTIFIER=VATES-S7836107H
        _configuration = new TicketBaiSCUConfiguration
        {
            EmisorNif = "S7836107H",
            EmisorApellidosNombreRazonSocial = "IZENPE S.A.",
            SoftwareLicenciaTBAI = "TBAIBI00000000PRUEBA",
            SoftwareNif = "A99800005",
            SoftwareName = "SOFTWARE GARANTE TICKETBAI PRUEBA",
            SoftwareVersion = "1.0.0",
            Certificate = new X509Certificate2(Convert.FromBase64String(certificateBase64.ToString()!), certificatePassword.ToString()!)
        };
    }

    protected override IESSSCD CreateScu()
    {
        var logger = NullLogger<TicketBaiSCU>. Instance;
        var territory = new TicketBaiBizkaiaTerritory();
        return new TicketBaiBizkaiaSCU(logger, _configuration);
    }
}
